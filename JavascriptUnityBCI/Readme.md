
The index.html file is found in WEBGL 2 -> build -> index.html. You will need to rebuild the program and copy the changes made from the modified index.html file to the index.html file generated by the Unity build.  ***IF you directly delete the generated index.html and directly replace it with the one provided in this project, theres a high chance it will break.  I'm pretty sure this has to do with the project name not being the same.  This step is described in the Setup portion of this readme.
# UnityToJavascriptExample
Example on how to use javascript to act as a bridge between an OpenBCI Ganglion Device and the Unity game engine in a WebGL build.  It also establishes a connection between Unity 2021.3.13 and javascipt utilizing the WEBGL framework.  This program allows bidirectional communication between Javascript and Unity.

## Description of all files added to the base Unity project
* C# Scripts
    * DisableWebGLKeyboardCapture.cs - This script runs the button "Enable typing outside of unity".  By default WEBGL captures all keystrokes and relays that to the Unity engine.  This means you can't type in html fields you create in the index.html file without disabling this.  The button which this is attached to allows you to disable or enable typing in the Unity editor.  Unfortunately, I couldnt find a way to allow both at the same time so for now the user has to select if they want to type in fields in the index.html file or if they want to type in a field in Unity by toggling the button provided in this Unity Scene.
    * JavascriptHook.cs - These functions provide the base functionality for sending data from javascript into Unity.  These functions are called from the index.html file to toggle various actions when the respective button is hit.
    * Spawner.cs - The spawner is called by the index.html buttons "Spawn a Dino using RGB colors" and "Make it rain"  This c sharp file serves as an example on how to create gameobjects from javascript.
    * uToJS.cs - short for Unity to Javascript.  This file contains the functions to send data from Unity to Javascript.  Right now it is a void function which just passes in "Hello World" as a string.  However following this pattern other data should be able to be transmitted.  Note:  This was a pain to get working.  You have to convert messages to bytes otherwise the message gets scrambled when its recieved in javascript resulting in unreadable characters.  You have to convert messages to bytes in Unity and then convert them back to strings in javascript.  This may only be the case for strings, but I'm not sure.
* index.html 
    * The index.html file is generated once you build your project.  There is an example index.html file which has all the additional funcitonality needed for this project provided in this repo.


## Note: In order to get Webgl to build in Unity you have to disable compression in the build settings, otherwise the engine will not load.  
* build settings -> player settings -> player -> publishing settings -> compression format -> disabled (default is brotli change this to disabled)
* Currently only working with microsoft edge browser.
* This demo is currently a work in progress and the data from the BCI device needs to be filtered before the game is playable.

## Setup
1. Create a new unity project. (Unity 2021.3.13 perfered, may or may not work with future versions.)
2. Import the JavascriptUnityBCIExample.unitypackage into your new unity project.
3. Build the project in Unity.
    * Note: make sure to disable compression in the build settings as mentioned in the beginning of this readme
4. Once built go to {_YourProjectName_} -> build -> index.html in the file structure of your unity project.
    * Take the index.html file from this example and compare it to the one generated in your project
    * All changes made to the index.html file have been denoted inside a "comment block".  I've used 4 * (****) to differentiate my comments from the comments generated by Unity in the index.html file.
    * Example:\
                // **** Initialize myGameInstance\
                var myGameInstance = null;\
                // **** END of addition

## Troubleshooting
* If your project builds but the game doesn't load. (Stuck on black screen with unity logo in browser)  This is likely a problem with the build settings.  Double check compression is off.
* When clicking the connect button in the webpage, if nothing happens use a different browser.